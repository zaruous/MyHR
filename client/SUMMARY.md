# NEXUS HRM 시스템 개발 요약

본 문서는 `HR.html`을 기반으로 구축된 통합 인사정보 시스템(HRMS)의 전체 개발 과정과 구현된 기능들을 요약합니다. 초기 정적 HTML 페이지에서 시작하여, 백엔드 API와 데이터베이스를 연동하고 주요 인사관리 기능을 구현하여 완전한 웹 애플리케이션으로 발전시켰습니다.

## 1. 초기 분석 및 목표 설정

- **초기 상태**: 단일 `HR.html` 파일에 하드코딩된 데이터와 일부 UI만 구현된 정적 페이지.
- **개발 목표**:
    1.  백엔드 서버 및 데이터베이스 구축.
    2.  모든 정적 데이터를 API 기반 동적 데이터로 전환.
    3.  인사관리, 급여관리, 근태관리, 평가관리, 시스템 설정 등 핵심 기능 구현.
    4.  사용자 인증 및 권한 관리 기능 추가.
    5.  경력개발을 위한 이력 관리 기능 추가.

## 2. 백엔드 및 데이터베이스 구축

- **기술 스택**:
    -   **서버**: Node.js, Express.js
    -   **데이터베이스**: MariaDB
    -   **인증**: JWT (JSON Web Tokens), bcrypt (비밀번호 해싱)
- **데이터베이스 스키마**: `hr` 데이터베이스 내에 아래와 같은 테이블들을 설계하고 생성했습니다.
    -   `departments`: 부서 정보 (계층 구조 포함)
    -   `job_positions`: 직급 정보 (레벨 포함)
    -   `employees`: 직원 기본 정보, 역할(`admin`/`user`), 비밀번호(해시), `job_position_id` 외래 키. (기존 `pos` 컬럼은 정규화됨)
    -   `salaries`: 연봉, 급여 계좌 정보
    -   `payroll_history`: 월별 급여 지급 내역
    -   `attendance`: 일별 근태 기록
    -   `evaluations`: 연도별 인사 평가 기록
    -   `system_settings`: 시스템 전역 설정 (급여 계산식 등)
    -   `employee_certifications`: 직원별 자격증 정보
    -   `employee_training`: 직원별 교육 이수 정보
    -   `employee_awards`: 직원별 수상 내역
    -   `employee_projects`: 직원별 프로젝트 이력
- **API 서버**: `HR/backend/server.js`에 모든 비즈니스 로직을 처리하는 RESTful API 엔드포인트를 구현했습니다.

## 3. 구현된 주요 기능

### 3.1. 공통 기능
- **인증 (Login)**:
    -   JWT 기반의 로그인/로그아웃 기능을 구현했습니다.
    -   관리자(admin)와 일반 사용자(user) 역할에 따른 권한을 분리했습니다.
    -   API 요청은 인증 미들웨어를 통해 보호됩니다.
    -   **비밀번호 변경**: 최초 로그인 사용자 또는 관리자에 의해 비밀번호가 설정되지 않은 사용자는 로그인 시 비밀번호 변경 페이지로 리디렉션됩니다.
- **동적 UI**:
    -   모든 데이터는 API를 통해 동적으로 로드 및 갱신됩니다.
    -   데이터 변경 시 즉시 UI가 새로고침되어 일관성을 유지합니다.

### 3.2. 인사관리 (`/` 또는 `인사관리` 탭)
- **사원 조회**: 전체 사원 목록을 확인하고, 이름/사번으로 검색하거나 재직 상태로 필터링할 수 있습니다.
- **조직도 필터링**: 좌측 조직도를 클릭하여 특정 부서 및 하위 부서의 소속 인원을 조회할 수 있습니다.
- **사원 CRUD**: 관리자(admin)는 사원의 정보를 조회, 생성, 수정, 삭제할 수 있습니다.
    -   사원 생성/수정 시, '시스템 설정'에 등록된 직급 목록이 드롭다운 형태로 제공되어 일관된 데이터 입력을 보장합니다.

### 3.3. 급여관리 (`급여관리` 탭)
- **급여 정보 관리**: 관리자는 직원별 연봉 및 급여 계좌 정보를 수정할 수 있습니다.
- **급여 대장 조회**: 특정 연도와 월을 선택하여 해당 월의 급여 지급 내역(기본급, 보너스, 공제액, 실수령액)을 조회할 수 있습니다.
- **급여 대장 생성**: 관리자는 "이 달의 급여대장 생성" 버튼을 통해 해당 월의 급여 대장을 일괄 생성할 수 있습니다. (중복 생성 방지 기능 포함)

### 3.4. 근태관리 (`근태관리` 탭)
- **월별 현황**: 월별 캘린더 형태로 전체적인 근태 현황(휴가, 결근 등)을 요약하여 보여줍니다. 이전/다음 달 버튼으로 탐색이 가능합니다.
- **일별 상세**: 캘린더에서 특정 날짜를 클릭하면 해당일의 전체 직원 근태 상태 목록을 확인할 수 있습니다.
- **상태 변경**: 관리자는 일별 상세 목록에서 각 직원의 근태 상태('출근', '휴가', '병가' 등)를 수정할 수 있습니다.

### 3.5. 평가관리 (`평가관리` 탭)
- **연도별 조회**: 드롭다운 메뉴에서 특정 연도를 선택하여 해당 연도의 전 직원 평가 현황을 조회합니다.
- **평가 요약**: 평가 완료율 및 등급(S, A, B, C)별 분포 현황을 시각적으로 보여줍니다.
- **평가 실시/수정**: 관리자는 각 직원에 대해 평가 등급과 피드백을 입력하거나 수정할 수 있습니다. (자기 자신은 평가 불가)

### 3.6. 경력관리 (`경력관리` 탭)
- **직원별 경력 조회**: 드롭다운에서 직원을 선택하여 해당 직원의 모든 경력 정보를 조회할 수 있습니다.
- **경력 정보 CRUD**: 관리자는 각 직원에 대해 다음 4가지 유형의 경력 정보를 생성, 수정, 삭제할 수 있습니다.
    -   **자격증**: 자격증명, 발급기관, 취득일 등
    -   **교육 이수**: 과정명, 교육기관, 기간 등
    -   **수상 내역**: 수상명, 수여기관, 수상일 등
    -   **프로젝트 이력**: 프로젝트명, 역할, 기간 등

### 3.7. 시스템 설정 (`시스템설정` 탭)
- **관리자 전용**: 이 페이지의 모든 기능은 관리자(admin)만 접근하고 조작할 수 있습니다.
- **조직도 관리**: 회사의 조직도(부서)를 생성, 수정, 삭제할 수 있습니다. 하위 부서나 소속된 직원이 있는 부서는 삭제되지 않도록 안전 장치가 구현되어 있습니다.
- **직급 관리**: 회사의 직급 체계(예: 사원, 대리, 과장)를 관리합니다. 직급명과 정렬 순서를 위한 '레벨'을 포함하며, 생성, 수정, 삭제가 가능합니다. 여기서 관리되는 직급 정보는 '인사관리' 탭에서 직원을 등록/수정할 때 사용됩니다.
- **급여 설정**: 급여 계산에 사용되는 전사 공통 보너스 및 공제액을 설정합니다.

## 4. 프론트엔드 리팩토링 및 동적 페이지 로딩

- **목표**: `HR.html` 내의 거대 스크립트 블록과 HTML 콘텐츠를 기능별로 분리하여 코드의 가독성, 유지보수성, 확장성을 향상시킵니다.
- **실행**:
    1.  `HR/js/` 디렉토리에 기존 스크립트를 `auth.js`, `main.js`, `hr.js`, `payroll.js`, `attendance.js`, `evaluation.js`, `system.js`, `career.js` 파일로 분리했습니다.
    2.  `HR/pages/` 디렉토리를 생성하고, `HR.html` 내의 각 페이지 섹션을 별도의 HTML 파일로 추출했습니다 (`hr.html`, `payroll.html`, `attendance.html`, `eval.html`, `system.html`, `career.html`).
    3.  `HR.html`을 빈 껍데기(Shell) 구조로 변경하고, `main.js`에서 `fetch` API를 사용하여 필요에 따라 각 페이지의 HTML 콘텐츠를 동적으로 로드하도록 구현했습니다.

## 5. 사용자 권한 관리 (RBAC) 강화

- **목표**: 관리자(admin)와 일반 사용자(user)의 접근 권한을 백엔드 및 프론트엔드 양단에서 엄격하게 제어하여 시스템의 보안을 강화합니다.
- **실행**:
    1.  **백엔드 (`HR/backend/server.js`, `HR/backend/adminOnly.js`):**
        *   JWT 토큰 검증 미들웨어(`authMiddleware.js`)에 더하여, `req.user.role`이 `'admin'`인지 확인하는 `adminOnly` 미들웨어를 새로 생성했습니다.
        *   직원/부서/직급/경력 정보의 CUD(Create, Update, Delete), 급여 정보 수정, 근태 기록 수정, 급여 대장 생성 등 **민감한 API 라우트**에 `adminOnly` 미들웨어를 적용하여 관리자만 해당 기능을 수행할 수 있도록 서버 레벨에서 권한을 제어합니다.
    2.  **프론트엔드 (UI-level RBAC):**
        *   **`main.js` (`renderHrPage`), `hr.js` (`showDetail`, `showEditEmployeeForm`):** '신규 등록', '정보 수정/저장', '삭제' 등 관리자용 버튼을 역할에 따라 표시/숨김 처리합니다.
        *   **`system.js`, `career.js`**: '시스템 설정'과 '경력 관리'의 CUD 기능은 모두 관리자에게만 허용됩니다.
        *   다른 모든 페이지에서도 관리자 전용 기능을 UI 레벨에서 제어합니다.

## 6. 실행 방법

1.  **데이터베이스 설정**:
    -   **신규 설치 시**: `HR/backend/db_schema.sql` 파일을 사용하여 데이터베이스 스키마를 생성합니다.
    -   **기존 DB에서 마이그레이션 시**: `node HR/backend/migrate_positions.js` 스크립트를 실행하여 `pos` 컬럼을 `job_position_id`로 마이그레이션합니다. **(실행 전 DB 백업 필수)**
2.  **서버 실행**:
    -   `HR/backend` 디렉토리에서 `npm start` 명령어로 백엔드 서버를 실행합니다.
3.  **클라이언트 실행**:
    -   웹 브라우저에서 `HR/client/HR.html` 파일을 엽니다.
4.  **로그인**:
    -   초기 관리자 계정:
        -   **사번**: `20220311`
        -   **비밀번호**: `password`